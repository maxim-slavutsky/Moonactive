# Class

## `Base`

### `constructor()`

### `logger: *`

## `EndPointBase`

### `validateSchema(obj: Object, schema: Object): ValidatorResult`

Validate provided object with given schema using Json schema validator

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| obj | Object |  |
| schema | Object |  |

### `formatValidationErrors(validationResult: Object)`

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| validationResult | Object |  |

### `createMethod(func: Function, validationSchema: Object): Function`

Create JSOn Rps method handler by wrapping provided function with some data formatting and error handling

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| func | Function |  |
| validationSchema | Object |  |

### `getErrorResponse(message: string, errors: Array): {valid: boolean, message: string, errors: Array}`

Get Error response object

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| message | string |  |
| errors | Array |  |

## `ModelBase`

## `Api`

Main API class that proves resolving and wrapping of various endpoints and methods. New endpoint can be implemented and placed in `endpoints` folder

### `constructor(port: Integer)`

Initialize API class

### `port: *`

### `webApp: *`

### `initialized: *`

### `start()`

Load available endpoint classes and start listening for incoming connections

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `loadMethods(): Promise`

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `addApiEndpoint(fileName: String)`

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| fileName | String |  |

## `Event`

Endpoint class that implements Events API with methods for managing events.

### `constructor()`

Initialize event model class

### `add: *`

### `remove: *`

### `addMethodImplementation(data: Object)`

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| data | Object |  |

### `removeMethodImplementation(data: Object)`

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| data | Object |  |

## `Main`

Main class for Moonactive test assignment. Creates API and Scheduler objects.

### `constructor()`

Initialize the class

### `api: *`

### `scheduler: *`

## `Logger`

Wrapper class for console.log with several styling enhancements

### `constructor()`

### `className: *`

### `getNowFormatted(): string`

Get current date and time formatted with milliseconds accuracy

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `writeLog(msg: String, level: String)`

Print log to console implementation

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| msg | String |  |
| level | String |  |

### `warn(msg: String)`

Log message with WARNING level

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| msg | String |  |

### `error(msg: String)`

Log message with ERROR level

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| msg | String |  |

### `log(msg: String)`

Log message with INFO level

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| msg | String |  |

## `RedisConnector`

Wrapper around Redis client class

### `constructor()`

Constructor method, initialize the class and automatically connect to server.

### `options: *`

### `isConnected: *`

### `reconnectAttempts: *`

### `redis: *`

### `client: *`

### `addCommands()`

Add new set of commands to Redis interface in order to enable Streams manipulations

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `connect()`

Connect to Redis server and bind connection events handlers

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `onError(err: Error)`

Handle Redis connection errors

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| err | Error |  |

### `addToQueue(streamName: string, id: string, params: ...string[], callback: Function)`

Add new message to the queue.

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| streamName | string |  |
| id | string | nullable: true | id of the message, if no id passed to the method, we use * in order to get autogenerated id |
| params | ...string[] |  | array of name-value pairs to be passed to Redis, for example - [name1, value1, name2, value2, ...] |
| callback | Function |  |

### `consumeFromQueue(groupName: string, consumerId: string, count: Integer, streamName: string, messageId: string, callback: Function)`

Read one or more messages from queue. Intended for use with consumer groups only

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| groupName | string |  |
| consumerId | string |  |
| count | Integer | nullable: true | if no count is provided, methos will attempt to read all available messages from queue |
| streamName | string |  |
| messageId | string | nullable: true | if no message is is provided, method will read available messages from the beginning using special id ">" |
| callback | Function |  |

### `addGroup(streamName: string, consumerId: string, callback: Function)`

Add new consumer group

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| streamName | string |  |
| consumerId | string |  |
| callback | Function |  |

### `acknowledgeMessage(streamName: *, groupName: *, msgId: *, callback: Function)`

Send acknowledgment for a queue message with a given id

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| streamName | * |  |
| groupName | * |  |
| msgId | * |  |
| callback | Function |  |

## `Event`

### `constructor(message: string, timestamp: Integer, id: string)`

Initialize Event class

### `timestamp: *`

### `message: *`

### `id: *`

### `stream()`

Add event to Redis stream

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `extractFromStreamMessage(rawArray: Array): Event`

Extract event data from stream message and create new Event class. Works much like a factory

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| rawArray | Array |  |

### `toString(): string`

Create json string representation for event for pretty print

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `execute()`

Execure event (print message to console) and execute callback method

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `schedule(callback: Function)`

Primitive implementation of event scheduling using setTimeout.

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| callback | Function |  |

## `Scheduler`

Class responsible for reading new and existing events from queue and processing them.

### `constructor()`

Initialize new Scheduler class

### `consumerId: *`

### `start()`

Start processing event history and new events from stream

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `createGroup()`

Create new consumer group

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `recover()`

Read all NOT acknowledged messages from queue and add them to the schedule

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `readStream()`

Read new events from stream

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |

### `processMessages(messages: *)`

Extract event object from stream message and schedule event for execution

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| messages | * |  |

### `acknowledgeMessage(event: Object)`

Each executed event will be acked to the stream therefore next time process recove from queue this message will be skipped

| Name | Type | Attribute | Description |
| --- | --- | --- | --- |
| event | Object |  |

# Function